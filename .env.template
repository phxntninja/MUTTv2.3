# =====================================================================
# MUTT v2.3 Environment Variables Template
# =====================================================================
# Copy this file to .env and fill in your actual values
# Usage: cp .env.template .env
# =====================================================================

# =====================================================================
# INGESTOR SERVICE
# =====================================================================
INGESTOR_HOST=0.0.0.0
INGESTOR_PORT=8080
INGESTOR_WORKERS=4

# =====================================================================
# ALERTER SERVICE
# =====================================================================
ALERTER_HEALTH_PORT=8081
ALERTER_METRICS_PORT=9091
POD_NAME=alerter-001

# =====================================================================
# MOOG FORWARDER SERVICE
# =====================================================================
MOOG_FORWARDER_HEALTH_PORT=8082
MOOG_FORWARDER_METRICS_PORT=9092
MOOG_WEBHOOK_URL=https://your-moog-instance.com/webhook
MOOG_TIMEOUT=10

# Rate Limiting
RATE_LIMIT_ENABLED=true
RATE_LIMIT_MAX_REQUESTS=100
RATE_LIMIT_WINDOW_SECONDS=60
RATE_LIMIT_KEY=mutt:rate_limit:moog

# Retry Config
RETRY_MAX_ATTEMPTS=5
RETRY_INITIAL_DELAY=1
RETRY_MAX_DELAY=60
RETRY_BACKOFF_MULTIPLIER=2

# =====================================================================
# WEB UI SERVICE
# =====================================================================
WEBUI_HOST=0.0.0.0
WEBUI_PORT=8090
WEBUI_WORKERS=2
METRICS_CACHE_TTL=5

# =====================================================================
# REDIS CONFIGURATION
# =====================================================================
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=
REDIS_TLS_ENABLED=false
REDIS_TLS_CA_CERT=/path/to/ca.crt
REDIS_TLS_CLIENT_CERT=/path/to/client.crt
REDIS_TLS_CLIENT_KEY=/path/to/client.key
REDIS_SOCKET_KEEPALIVE=true
REDIS_HEALTH_CHECK_INTERVAL=30

# Queue Names
INGEST_QUEUE_NAME=mutt:ingest_queue
ALERT_QUEUE_NAME=mutt:alert_queue
PROCESSING_LIST_PREFIX_ALERTER=mutt:processing:alerter
PROCESSING_LIST_PREFIX_MOOG=mutt:processing:moog
DLQ_NAME=mutt:dlq:moog
UNHANDLED_KEY_PREFIX=mutt:unhandled

# Queue Config
INGEST_QUEUE_CAP=1000000
BRPOPLPUSH_TIMEOUT=5

# =====================================================================
# POSTGRESQL CONFIGURATION
# =====================================================================
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=mutt
POSTGRES_USER=mutt_user
POSTGRES_PASSWORD=CHANGE_ME_SECURE_PASSWORD
POSTGRES_TLS_ENABLED=false
POSTGRES_TLS_CA_CERT=/path/to/ca.crt
POSTGRES_TLS_CLIENT_CERT=/path/to/client.crt
POSTGRES_TLS_CLIENT_KEY=/path/to/client.key

# Connection Pooling
POSTGRES_POOL_MIN=2
POSTGRES_POOL_MAX=10

# =====================================================================
# VAULT CONFIGURATION
# =====================================================================
VAULT_ADDR=https://vault.yourdomain.com:8200
VAULT_TOKEN=your-vault-token-here
VAULT_MOUNT_PATH=secret
VAULT_SECRET_PATH=mutt/prod
VAULT_TOKEN_RENEW_THRESHOLD=86400
VAULT_TLS_CA_CERT=/path/to/vault-ca.crt
VAULT_TLS_VERIFY=true

# =====================================================================
# PROCESSING CONFIGURATION
# =====================================================================
RULE_CACHE_TTL=300
JANITOR_INTERVAL=60
HEARTBEAT_INTERVAL=10
HEARTBEAT_EXPIRY=30
POISON_MESSAGE_MAX_RETRIES=3

# =====================================================================
# LOGGING
# =====================================================================
LOG_LEVEL=INFO
LOG_FORMAT=json

# =====================================================================
# MONITORING
# =====================================================================
METRICS_PORT=9090
PROMETHEUS_ENABLED=true
PROMETHEUS_URL=http://prometheus:9090

# =====================================================================
# PHASE 3.1: CIRCUIT BREAKER & RATE LIMITING
# =====================================================================
# Circuit Breaker (Moog Forwarder)
CIRCUIT_BREAKER_ENABLED=true
CIRCUIT_BREAKER_THRESHOLD=10
CIRCUIT_BREAKER_TIMEOUT=300

# Ingestor Rate Limiting
RATE_LIMIT_ENABLED=true
INGEST_MAX_RATE=1000
INGEST_RATE_WINDOW=60

# Alerter Backpressure (v2.5 canonical keys)
ALERTER_QUEUE_WARN_THRESHOLD=1000
ALERTER_QUEUE_SHED_THRESHOLD=2000
ALERTER_SHED_MODE=dlq
ALERTER_DEFER_SLEEP_MS=250

# =====================================================================
# PHASE 3.2: REMEDIATION SERVICE
# =====================================================================
# Remediation Service Config
REMEDIATION_ENABLED=true
REMEDIATION_INTERVAL=300
REMEDIATION_BATCH_SIZE=10
MAX_POISON_RETRIES=3
METRICS_PORT_REMEDIATION=8086
HEALTH_PORT_REMEDIATION=8087

# DLQ Configuration
ALERTER_DLQ_NAME=mutt:dlq:alerter
DEAD_LETTER_QUEUE=mutt:dlq:dead

# Moogsoft Health Check
MOOG_HEALTH_CHECK_ENABLED=true
MOOG_HEALTH_TIMEOUT=5

# =====================================================================
# PHASE 3.3: SLO TRACKING (Future)
# =====================================================================
# SLO_INGEST_SUCCESS_TARGET=0.995
# SLO_FORWARD_SUCCESS_TARGET=0.99
# SLO_WINDOW_HOURS=24
# SLO_BURN_RATE_CRITICAL=14.4
# SLO_BURN_RATE_WARNING=6.0

# =====================================================================
# DYNAMIC CONFIGURATION
# =====================================================================
# Enable runtime configuration updates via Redis
DYNAMIC_CONFIG_ENABLED=false

# =====================================================================
# PHASE 4.3: DATA RETENTION (v2.5)
# =====================================================================
# Enable/disable retention enforcement
RETENTION_ENABLED=true

# Dry-run mode (log what would be deleted)
RETENTION_DRY_RUN=false

# Retention periods (days)
RETENTION_AUDIT_DAYS=365        # Configuration audit logs (PostgreSQL)
RETENTION_EVENT_AUDIT_DAYS=90   # Event audit logs (PostgreSQL)
RETENTION_DLQ_DAYS=30           # Dead Letter Queue messages (Redis)

# Cleanup batch size (records per transaction)
RETENTION_CLEANUP_BATCH_SIZE=1000

# =====================================================================
# SECURITY
# =====================================================================
# These should be stored in Vault in production
# Listed here for reference only
# INGEST_API_KEY=stored-in-vault
# WEBUI_API_KEY=stored-in-vault
# POSTGRES_PASSWORD=stored-in-vault
# MOOG_API_KEY=stored-in-vault
