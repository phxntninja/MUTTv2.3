groups:
  - name: mutt-v25
    rules:
      - alert: MUTTIngestQueueHigh
        expr: mutt_ingest_queue_depth > 10000
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Ingest queue depth is high (>10k)"
          description: "mutt_ingest_queue_depth={{ $value }}"

      - alert: MUTTUnhandledMetaAlertsSpike
        expr: rate(mutt_alerter_unhandled_meta_alerts_total[10m]) > 5
        for: 10m
        labels:
          severity: critical
        annotations:
          summary: "Unhandled meta-alerts spiking"
          description: "rate over 10m is {{ $value }}"

      - alert: MUTTMoogRateLimitHitsHigh
        expr: rate(mutt_moog_rate_limit_hits_total[5m]) > 20
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Moog forwarder hitting rate limit"
          description: "hits rate over 5m is {{ $value }}"

      - alert: MUTTServiceDownWebUI
        expr: up{job="mutt-webui"} == 0
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "Web UI service down"

      - alert: MUTTServiceDownIngestor
        expr: up{job="mutt-ingestor"} == 0
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "Ingestor service down"

  - name: mutt-core
    rules:
      - alert: MUTTIngestQueueNearCapacity
        expr: mutt_ingest_queue_depth > 900000
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "MUTT ingest queue near capacity"
          description: |
            Ingest queue depth is above 900k for 5 minutes. Verify downstream processing
            (alerter/forwarder), backpressure, and Redis health.

      - alert: MUTTAlerterDown
        expr: up{job="mutt-alerter"} == 0
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "MUTT Alerter service is down"
          description: |
            No targets for job=mutt-alerter are up. Check pods/instance logs and health endpoint.

      - alert: MUTTMoogForwardFailures
        expr: sum(rate(mutt_moog_requests_total{status=~"fail_.*"}[5m])) > 0.1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High Moog forward failure rate"
          description: |
            Moog webhook requests are failing (>0.1 req/s over 5m). Inspect network, Moog availability,
            TLS, and credentials. Rate-limiting may also trigger retries.

      - alert: MUTTMoogCircuitOpen
        expr: mutt_moog_circuit_open == 1
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "Moog circuit breaker is OPEN"
          description: |
            The circuit breaker for Moog forwarder has been open for >2m. Investigate Moog health,
            network connectivity, and recent error spikes.
